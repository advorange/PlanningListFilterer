@page "/anilistplanning"
@inject HttpClient Http
@inject ILocalStorageService LocalStorage
@inject ListSettingsService ListSettingsService

<PageTitle>Planning List Filterer</PageTitle>

<MudDataGrid Dense="true" Hover="true" Bordered="true" Striped="true" Filterable="true"
			 FixedHeader="true" FixedFooter="true" ShowColumnOptions="false"
			 ColumnResizeMode="ResizeMode.None"
			 FilterMode="DataGridFilterMode.ColumnFilterMenu"
			 Class="planning-table" Height="85vh" Loading="@IsLoading"
			 @ref="Grid" Items="@Entries" QuickFilter="@(x => x.IsVisible)">
	<ToolBarContent>
		<MudText Typo="Typo.h6">Planning List Filterer</MudText>
		<MudSpacer />
		<MudSpacer />
		<MudSpacer />
		<MudTextField Class="mb-5" Placeholder="Enter a username to get entries from..."
					  @bind-Value="@Username" />
		<MudButton Color="Color.Primary" OnClick="@LoadEntries">
			Load Entries
		</MudButton>
		<MudButton Color="Color.Primary" OnClick="@RandomizeTable"
				   Disabled="@(Entries.Count == 0)">
			Random
		</MudButton>
	</ToolBarContent>

	<Columns>
		<Column T="AnilistModel" Field="Id"
				SortBy="@(m => m.Id)">
			<CellTemplate>
				<MudNavLink Class="transparent-hover-bg" Target="_blank"
							Href="@context.Item.GetUrl()">
					<MudImage Src="@context.Item.CoverImageUrl" />
				</MudNavLink>
			</CellTemplate>
		</Column>
		<Column T="AnilistModel" Field="Title" CellClass="text-wrap"
				SortBy="@(m => m.Title)" />
		<Column T="AnilistModel" Field="Start"
				SortBy="@(m => m.Start)">
			<CellTemplate>@context.Item.DisplayStart()</CellTemplate>
		</Column>
		<Column T="AnilistModel" Field="Episodes"
				SortBy="@(m => m.Episodes)">
			<CellTemplate>@context.Item.DisplayEpisodeCount()</CellTemplate>
		</Column>
		<Column T="AnilistModel" Field="Duration"
				SortBy="@(m => m.Duration)">
			<CellTemplate>@context.Item.DisplayDuration()</CellTemplate>
		</Column>
		<Column T="AnilistModel" Field="Score"
				SortBy="@(m => m.Score)">
			<CellTemplate>@context.Item.DisplayScore()</CellTemplate>
		</Column>
		<Column T="AnilistModel" Field="FriendScore" Title="Friend Score"
				SortBy="@(m => m.FriendScore)"
				Hidden="@(!ListSettings.EnableFriendScores)">
			<CellTemplate>@context.Item.DisplayFriendScore()</CellTemplate>
		</Column>
		<Column T="AnilistModel" Field="Popularity"
				SortBy="@(m => m.Popularity)" />
		<Column T="AnilistModel" Field="Format"
				SortBy="@(m => m.Format.ToString())" />
		<Column T="AnilistModel" Field="IsSequel" Title="Sequel"
				SortBy="@(m => !m.IsSequel)" />
		<Column T="AnilistModel" Field="Genres"
				Sortable="false">
			<FilterTemplate>
				<FilterSelection Source="@Filterer.Genres" Label="Genre" />
			</FilterTemplate>

			<CellTemplate>
				<MudText Class="text-pre">@context.Item.DisplayGenres()</MudText>
			</CellTemplate>
		</Column>
		<Column T="AnilistModel" Field="Tags"
				Sortable="false">
			<FilterTemplate>
				<FilterSelection Source="@Filterer.Tags" Label="Tag" />
			</FilterTemplate>

			<CellTemplate>
				<MudExpansionPanel Class="bg-transparent no-disabled-text"
								   Text="@context.Item.DisplayTags(0, 1)"
								   Disabled="@(context.Item.Tags.Count <= 1)"
								   HideIcon="@(context.Item.Tags.Count <= 1)">
					<MudText Class="text-pre">@context.Item.DisplayTags(1, int.MaxValue)</MudText>
				</MudExpansionPanel>
			</CellTemplate>
		</Column>
	</Columns>

	<PagerContent>
		<MudDataGridPager T="AnilistModel" />
	</PagerContent>
</MudDataGrid>